<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mini Clock — Analogue & Digital</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --text:#0b1220; --muted:#6b7280; --accent:#2563eb;
      --clock-face:#ffffff; --clock-stroke:rgba(2,6,23,0.06); --clock-hands:#081228; --clock-ticks:#081228;
    }
    [data-theme="dark"]{
      --bg:#071026; --card:#0f1b3d; --text:#e6eef8; --muted:#9aa6bd; --accent:#60a5fa;
      --clock-face:#0f1b3d; --clock-stroke:rgba(255,255,255,0.1); --clock-hands:#e6eef8; --clock-ticks:#e6eef8;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      background:linear-gradient(180deg,var(--bg),var(--card) 50%);
      display:flex;align-items:center;justify-content:center;padding:24px;color:var(--text);
    }

    .card{
      width:360px; max-width:94vw; padding:18px; border-radius:12px; background:var(--card);
      box-shadow:0 10px 30px rgba(2,6,23,0.08); text-align:center;
    }

    h1{margin:0;font-size:16px}
    .display{
      margin:12px auto 8px; width:280px; height:280px; display:flex;align-items:center;justify-content:center;
    }

    canvas{width:100%;height:100%; display:block}
    .digital{
      font-size:56px; font-weight:700; letter-spacing:-0.02em; color:var(--text);
    }
    .greeting{font-size:14px;color:var(--muted); margin:10px 0 14px}

    .controls{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
    .btn{
      border:0;padding:8px 12px;border-radius:8px;font-weight:600;cursor:pointer;background:var(--accent);color:white;
    }
    .muted-btn{background:transparent;border:1px solid var(--clock-stroke);color:var(--muted);padding:8px 12px;border-radius:8px}
    .tiny{font-size:12px;padding:6px 8px}

    .meta{margin-top:12px;font-size:11px;color:var(--muted)}
    @media (max-width:380px){
      .card{padding:14px}
      .display{width:240px;height:240px}
      .digital{font-size:44px}
    }
  </style>
</head>
<body>
  <main class="card" id="app" role="application" aria-labelledby="title">
    <h1 id="title">Mini Clock</h1>

    <div class="display" id="displayArea">
      <!-- Analogue canvas -->
      <canvas id="clockCanvas" aria-label="Analogue clock"></canvas>

      <!-- Digital fallback (initially hidden) -->
      <div id="digital" class="digital" style="display:none" aria-live="polite">--:--:--</div>
    </div>

    <div id="greeting" class="greeting">Hello — hope you're well.</div>

    <div class="controls" role="toolbar" aria-label="Clock controls">
      <button id="toggleTheme" class="btn" aria-pressed="false">Toggle theme</button>
      <button id="switchMode" class="muted-btn tiny" aria-pressed="false">Switch to digital</button>
      <button id="toggleSeconds" class="muted-btn tiny" aria-pressed="true">Hide seconds</button>
    </div>

  </main>

<script>
(() => {
  // Elements
  const root = document.documentElement;
  const canvas = document.getElementById('clockCanvas');
  const ctx = canvas.getContext('2d');
  const digitalEl = document.getElementById('digital');
  const greetingEl = document.getElementById('greeting');
  const themeBtn = document.getElementById('toggleTheme');
  const modeBtn = document.getElementById('switchMode');
  const secBtn = document.getElementById('toggleSeconds');

  // State
  let mode = 'analogue'; // 'analogue' | 'digital'
  let showSeconds = true;
  const dpr = () => window.devicePixelRatio || 1;

  // Get CSS variable
  function getCssVar(name) {
    return getComputedStyle(root).getPropertyValue(name).trim();
  }

  // Responsive sizing (CSS px)
  function cssSize() {
    const rect = canvas.getBoundingClientRect();
    return { w: rect.width, h: rect.height };
  }

  // Resize canvas for high DPI and update drawing transforms
  function resizeCanvas() {
    const { w, h } = cssSize();
    const scale = dpr();
    canvas.width = Math.round(w * scale);
    canvas.height = Math.round(h * scale);
    ctx.setTransform(scale, 0, 0, scale, 0, 0); // draw in CSS pixels
  }

  // Compute centre and radius in CSS pixels
  function metrics() {
    const { w, h } = cssSize();
    const cx = w / 2;
    const cy = h / 2;
    const radius = Math.min(w, h) / 2 - 12; // margin
    return { cx, cy, radius, w, h };
  }

  // Draw face and ticks (ticks placed based on centre + trig)
  function drawAnalogue(now) {
    const { cx, cy, radius, w, h } = metrics();
    ctx.clearRect(0, 0, w, h);

    // Outer disc + bezel
    ctx.beginPath();
    ctx.arc(cx, cy, radius + 8, 0, Math.PI * 2);
    ctx.fillStyle = getCssVar('--clock-face');
    ctx.fill();
    ctx.lineWidth = 1.5;
    ctx.strokeStyle = getCssVar('--clock-stroke');
    ctx.stroke();

    // Draw ticks: translate to centre to simplify trig math
    ctx.save();
    ctx.translate(cx, cy);
    for (let i = 0; i < 60; i++) {
      const angle = (i / 60) * Math.PI * 2; // radians from positive X; we rotate accordingly below
      const isHour = i % 5 === 0;
      const tickLength = isHour ? 14 : 7;
      const lineWidth = isHour ? 3 : 1.6;

      const xOuter = Math.cos(angle - Math.PI/2) * radius; // -90° so 0 index is 12 o'clock
      const yOuter = Math.sin(angle - Math.PI/2) * radius;
      const xInner = Math.cos(angle - Math.PI/2) * (radius - tickLength);
      const yInner = Math.sin(angle - Math.PI/2) * (radius - tickLength);

      ctx.beginPath();
      ctx.moveTo(xOuter, yOuter);
      ctx.lineTo(xInner, yInner);
      ctx.lineWidth = lineWidth;
      ctx.strokeStyle = getCssVar('--clock-ticks');
      ctx.lineCap = 'round';
      ctx.stroke();
    }
    ctx.restore();

    // Hands (hours, minutes, seconds)
    const s = now.getSeconds() + now.getMilliseconds() / 1000;
    const m = now.getMinutes() + s / 60;
    const hval = (now.getHours() % 12) + m / 60;

    ctx.save();
    ctx.translate(cx, cy);

    // hour hand
    ctx.beginPath();
    ctx.lineWidth = 6;
    ctx.lineCap = 'round';
    rotateAndDraw((hval / 12) * Math.PI * 2, 0, -radius * 0.5, getCssVar('--clock-hands'));

    // minute hand
    ctx.beginPath();
    ctx.lineWidth = 4;
    rotateAndDraw((m / 60) * Math.PI * 2, 0, -radius * 0.72, getCssVar('--clock-hands'));

    // second hand (optional)
    if (showSeconds) {
      ctx.beginPath();
      ctx.lineWidth = 2;
      rotateAndDraw((s / 60) * Math.PI * 2, 0, -radius * 0.85, getCssVar('--accent'));
    }

    // centre pin
    ctx.beginPath();
    ctx.fillStyle = getCssVar('--clock-hands');
    ctx.arc(0, 0, 6, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();

    function rotateAndDraw(angle, y0, y1, stroke) {
      ctx.save();
      ctx.rotate(angle - Math.PI/2); // rotate so 0 is at 12 o'clock
      ctx.moveTo(0, y0);
      ctx.lineTo(0, y1);
      ctx.strokeStyle = stroke;
      ctx.stroke();
      ctx.restore();
    }
  }

  // Digital draw
  function drawDigital(now) {
    const pad = (n) => String(n).padStart(2, '0');
    const h = now.getHours(), m = now.getMinutes(), s = now.getSeconds();
    digitalEl.textContent = showSeconds ? `${pad(h)}:${pad(m)}:${pad(s)}` : `${pad(h)}:${pad(m)}`;
  }

  // Greeting text (feel-good comments)
  function updateGreeting(now) {
    const h = now.getHours();
    let greet = "Hello — hope you're well.";
    if (h >= 5 && h < 12) greet = "Good morning — have a great start to your day.";
    else if (h >= 12 && h < 17) greet = "Good afternoon — keep going.";
    else if (h >= 17 && h < 21) greet = "Good evening — hope you had a nice day.";
    else greet = "Good night — take care.";
    greetingEl.textContent = greet;
  }

  // Unified update loop: requestAnimationFrame for smooth analogue, update digital & greeting each second
  let lastSecond = -1;
  function tick(nowTimestamp) {
    const now = new Date();
    // ensure canvas is correctly sized (handles orientation changes)
    resizeCanvas();

    if (mode === 'analogue') {
      canvas.style.display = '';
      digitalEl.style.display = 'none';
      drawAnalogue(now);
    } else {
      canvas.style.display = 'none';
      digitalEl.style.display = '';
      drawDigital(now);
    }

    // Update greeting once per second
    if (now.getSeconds() !== lastSecond) {
      updateGreeting(now);
      lastSecond = now.getSeconds();
    }

    requestAnimationFrame(tick);
  }

  // Initialise
  function init() {
    // initial sizing and start loop
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // theme restore (session)
    const savedTheme = sessionStorage.getItem('theme');
    if (savedTheme) root.setAttribute('data-theme', savedTheme);

    // Update button states based on initial theme
    themeBtn.setAttribute('aria-pressed', String(!!savedTheme));

    // button handlers
    themeBtn.addEventListener('click', () => {
      const current = root.getAttribute('data-theme');
      const next = current === 'dark' ? '' : 'dark';
      if (next) root.setAttribute('data-theme', next); else root.removeAttribute('data-theme');
      themeBtn.setAttribute('aria-pressed', String(!!next));
      sessionStorage.setItem('theme', next || '');
    });

    modeBtn.addEventListener('click', () => {
      mode = mode === 'analogue' ? 'digital' : 'analogue';
      modeBtn.textContent = mode === 'analogue' ? 'Switch to digital' : 'Switch to analogue';
      modeBtn.setAttribute('aria-pressed', String(mode === 'digital'));
    });

    secBtn.addEventListener('click', () => {
      showSeconds = !showSeconds;
      secBtn.textContent = showSeconds ? 'Hide seconds' : 'Show seconds';
      secBtn.setAttribute('aria-pressed', String(!showSeconds));
    });

    // keyboard shortcuts: T = theme, S = seconds, D = toggle mode
    window.addEventListener('keydown', (e) => {
      const k = e.key.toLowerCase();
      if (k === 't') themeBtn.click();
      if (k === 's') secBtn.click();
      if (k === 'd') modeBtn.click();
    });

    requestAnimationFrame(tick);
  }

  // run
  init();

})();
</script>
</body>
</html>
